"use strict";(()=>{var e={};e.id=104,e.ids=[104],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2053:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>m,originalPathname:()=>f,patchFetch:()=>_,requestAsyncStorage:()=>h,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>w});var r={};a.r(r),a.d(r,{GET:()=>l,OPTIONS:()=>d});var o=a(5419),s=a(9108),n=a(9678),c=a(8070);let i={data:null,lastFetch:0};async function l(e){try{let t=!1;try{t=new URL(e.url).searchParams.has("t")}catch(e){t=!1}let a=Date.now(),r=a-i.lastFetch,o=i.data&&r<3e5;if(!t&&o)return console.log(`Returning cached data (age: ${Math.round(r/1e3)}s)`),c.Z.json({repositories:i.data,cached_at:new Date(i.lastFetch).toISOString(),total_count:i.data.length,cache_age_seconds:Math.round(r/1e3)},{headers:{"Cache-Control":"public, s-maxage=300, stale-while-revalidate=600"}});console.log(t?"Force refresh requested":"Cache expired, fetching fresh data");let s=new Date;s.setDate(s.getDate()-7);let n=s.toISOString().split("T")[0];console.log("=== GitHub API Request ==="),console.log("Current time:",new Date().toISOString()),console.log("7 days ago date:",n),console.log("Cache last fetch:",new Date(i.lastFetch).toISOString()),console.log("Cache age:",Math.round(r/1e3),"seconds");let l=`topic:ai created:>${n}`;console.log("Search query:",l);let d=`https://api.github.com/search/repositories?q=${encodeURIComponent(l)}&sort=stars&order=desc&per_page=30`;console.log("Full GitHub API URL:",d);let u=await fetch(d,{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"AI-News-Aggregator/1.0"}});if(console.log("GitHub API response status:",u.status),!u.ok){let e=await u.text();if(console.error("=== GitHub API Error ==="),console.error("Status:",u.status),console.error("Status Text:",u.statusText),console.error("Error Body:",e),console.error("Request URL:",d),i.data)return console.log("Returning stale cached data due to API error"),c.Z.json({repositories:i.data,cached_at:new Date(i.lastFetch).toISOString(),total_count:i.data.length,warning:"Using stale cached data due to GitHub API error",cache_age_seconds:Math.round(r/1e3)});if(403===u.status)throw Error("GitHub API rate limit exceeded. Please try again later.");throw Error(`GitHub API error: ${u.status}`)}let h=await u.json();console.log(`Strict 7-day query returned ${h.items.length} repositories`);let g=h.items.filter(e=>{let t=e.topics||[],a=["ai","machine-learning","llm","artificial-intelligence","deep-learning","neural-network","tensorflow","pytorch","opencv"],r=t.some(e=>a.some(t=>e.toLowerCase().includes(t.toLowerCase()))),o=(e.name+" "+(e.description||"")).toLowerCase().match(/(ai|artificial|intelligence|machine|learning|neural|deep|ml|nlp|computer.vision|data.science)/i);return(r||o)&&e.stargazers_count>=0});return i.data=g,i.lastFetch=a,console.log(`Successfully fetched and cached ${g.length} repositories`),c.Z.json({repositories:g,cached_at:new Date(a).toISOString(),total_count:g.length,cache_age_seconds:0},{headers:{"Cache-Control":"public, s-maxage=300, stale-while-revalidate=600"}})}catch(e){if(console.error("Error in trends API:",e),i.data){let e=Date.now()-i.lastFetch;return console.log("Returning stale cached data due to error"),c.Z.json({repositories:i.data,cached_at:new Date(i.lastFetch).toISOString(),total_count:i.data.length,warning:"Using stale cached data due to API error",cache_age_seconds:Math.round(e/1e3)})}return c.Z.json({error:e instanceof Error?e.message:"Failed to fetch repositories",repositories:[],total_count:0},{status:500})}}async function d(){let e=i.lastFetch?Date.now()-i.lastFetch:0;return c.Z.json({message:"GitHub Trends API with In-Memory Caching",cache_duration_minutes:5,cache_status:{has_data:!!i.data,last_fetch:i.lastFetch?new Date(i.lastFetch).toISOString():null,age_seconds:i.lastFetch?Math.round(e/1e3):0,is_valid:i.data&&e<3e5},endpoints:{"GET /api/trends":"Returns trending AI/ML repositories","GET /api/trends?t=timestamp":"Forces cache refresh"}})}let u=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/trends/route",pathname:"/api/trends",filename:"route",bundlePath:"app/api/trends/route"},resolvedPagePath:"/Users/yarinshushan/Desktop/Afeka<Shushan>HW1/pr3/app/api/trends/route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:p,headerHooks:m,staticGenerationBailout:w}=u,f="/api/trends/route";function _(){return(0,n.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:g})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[638,206],()=>a(2053));module.exports=r})();